---
// LanguageSwitcher.astro
// Componente para cambiar entre idiomas con un icono de globo

interface Props {
  currentPath: string;
  currentLang: string;
}

const { currentPath, currentLang } = Astro.props;

// Mapeo específico de rutas - calculado en el servidor
function getLanguageUrls(path: string) {
  const routeMap: Record<string, { es: string, en: string }> = {
    '/': { es: '/', en: '/en' },
    '/en': { es: '/', en: '/en' },
    '/en/': { es: '/', en: '/en' },
    // Rutas de pre-registro (español en /es/ por tu estructura de archivos)
    '/es/pre-registro': { es: '/es/pre-registro', en: '/en/pre-registration' },
    '/en/pre-registration': { es: '/es/pre-registro', en: '/en/pre-registration' }
  };

  if (routeMap[path]) {
    return routeMap[path];
  }

  // Fallback
  if (path.startsWith('/en/')) {
    const esPath = path.replace('/en/', '/es/') || '/es';
    return { es: esPath, en: path };
  } else if (path === '/en') {
    return { es: '/', en: '/en' };
  } else if (path.startsWith('/es/')) {
    const enPath = path.replace('/es/', '/en/');
    return { es: path, en: enPath };
  } else {
    const enPath = path === '/' ? '/en' : '/en' + path;
    return { es: path, en: enPath };
  }
}

const urls = getLanguageUrls(currentPath);
---

<div class="relative group">
  <button aria-label="Cambiar idioma" class="flex items-center gap-1 p-2 rounded-md hover:bg-gray-100 transition-colors duration-200">
    <img src="/icons/globe.svg" alt="Cambiar idioma" class="h-5 w-5 text-gray-600" />
    <span class="text-sm font-medium">{currentLang === 'en' ? 'EN' : 'ES'}</span>
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
  </button>
  
  <div class="absolute right-0 mt-1 w-24 bg-white rounded-md shadow-lg overflow-hidden transform scale-0 group-hover:scale-100 opacity-0 group-hover:opacity-100 transition-all duration-200 origin-top-right z-50">
    <a href={urls.es} class={`block px-4 py-2 text-sm text-gray-700 hover:bg-primary-50 hover:text-primary-600 ${currentLang === 'es' ? 'bg-primary-50 text-primary-600 font-medium' : ''}`}>Español</a>
    <a href={urls.en} class={`block px-4 py-2 text-sm text-gray-700 hover:bg-primary-50 hover:text-primary-600 ${currentLang === 'en' ? 'bg-primary-50 text-primary-600 font-medium' : ''}`}>English</a>
  </div>
</div>

<!-- Debug info removido -->
