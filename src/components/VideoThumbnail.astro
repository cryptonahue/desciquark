---
interface Props {
  videoId: string; // YouTube video ID
  title: string;
  thumbnail?: string; // Thumbnail personalizado opcional
}

const { videoId, title, thumbnail } = Astro.props;

// Generar thumbnail de YouTube si no se proporciona uno personalizado
const defaultThumbnail = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
const thumbnailSrc = thumbnail || defaultThumbnail;
---

<div id={`video-thumbnail-${videoId}`} class="video-thumbnail-container relative group cursor-pointer rounded-xl overflow-hidden shadow-xl">
  <!-- Thumbnail -->
  <img 
    src={thumbnailSrc}
    alt={title}
    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
    loading="lazy"
  />
  
  <!-- Overlay oscuro -->
  <div class="absolute inset-0 bg-black/20 group-hover:bg-black/30 transition-colors duration-300"></div>
  
  <!-- Botón de play -->
  <div class="absolute inset-0 flex items-center justify-center">
    <div class="play-button bg-white/90 backdrop-blur-sm rounded-full p-6 group-hover:bg-white group-hover:scale-110 transition-all duration-300 shadow-2xl">
      <svg class="w-8 h-8 text-primary-600 ml-1" fill="currentColor" viewBox="0 0 24 24">
        <path d="M8 5v14l11-7z"/>
      </svg>
    </div>
  </div>
  
</div>


<script define:vars={{ videoId, title }}>
  // Video thumbnail modal functionality
  document.addEventListener('DOMContentLoaded', () => {
    const thumbnail = document.getElementById(`video-thumbnail-${videoId}`);
    
    if (!thumbnail) {
      console.error('Thumbnail not found:', `video-thumbnail-${videoId}`);
      return;
    }
    
    console.log('Video thumbnail setup complete for:', videoId);
    
    // Crear modal dinámicamente
    const createModal = () => {
      // Verificar si ya existe
      if (document.getElementById(`video-modal-${videoId}`)) return;
      
      const modal = document.createElement('div');
      modal.id = `video-modal-${videoId}`;
      modal.className = 'fixed inset-0 z-50 bg-black/95 backdrop-blur-sm hidden items-center justify-center p-4';
      modal.style.backdropFilter = 'blur(8px)';
      
      modal.innerHTML = `
        <button class="close-modal absolute top-4 right-4 z-60 text-white hover:text-gray-300 transition-colors" aria-label="Cerrar video">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
        <div class="video-container-modal max-w-6xl w-full relative">
          <div class="aspect-video bg-black rounded-lg overflow-hidden">
            <!-- El iframe se inyecta aquí dinámicamente -->
          </div>
        </div>
      `;
      
      // Agregar al body
      document.body.appendChild(modal);
      return modal;
    };
    
    // Abrir modal
    thumbnail.addEventListener('click', () => {
      console.log('Thumbnail clicked, opening modal');
      
      // Crear modal si no existe
      const modal = createModal() || document.getElementById(`video-modal-${videoId}`);
      const closeBtn = modal.querySelector('.close-modal');
      const videoContainer = modal.querySelector('.video-container-modal .aspect-video');
      
      if (!modal || !closeBtn || !videoContainer) {
        console.error('Failed to create or find modal elements');
        return;
      }
      
      // Crear iframe del video
      const iframe = document.createElement('iframe');
      iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
      iframe.className = 'w-full h-full';
      iframe.setAttribute('frameborder', '0');
      iframe.setAttribute('allowfullscreen', '');
      iframe.setAttribute('allow', 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture');
      
      // Limpiar contenedor y agregar iframe
      videoContainer.innerHTML = '';
      videoContainer.appendChild(iframe);
      
      // Mostrar modal
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      document.body.style.overflow = 'hidden';
      
      // Configurar eventos de cierre
      const closeModal = () => {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        document.body.style.overflow = '';
        videoContainer.innerHTML = '';
      };
      
      // Cerrar con botón X
      closeBtn.onclick = closeModal;
      
      // Cerrar clicando fuera del video
      modal.onclick = (e) => {
        if (e.target === modal) closeModal();
      };
      
      // Cerrar con ESC
      const handleEsc = (e) => {
        if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
          closeModal();
          document.removeEventListener('keydown', handleEsc);
        }
      };
      document.addEventListener('keydown', handleEsc);
    });
  });
</script>

<style>
  .video-modal {
    backdrop-filter: blur(8px);
  }
  
  .play-button {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  }
  
  /* Animación suave para modal */
  .video-modal.flex {
    animation: fadeIn 0.3s ease-out;
  }
  
  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
</style>