---
import { getLangFromUrl, useTranslations } from '../i18n/utils';
import ModuleCard from './ModuleCard.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// Función para obtener todas las lecciones de un módulo dinámicamente
function getModuleLessons(moduleKey: string) {
  const lessons = [];
  let lessonIndex = 1;
  
  while (true) {
    const lessonKey = `courseContent.${moduleKey}.lesson${lessonIndex}`;
    try {
      const lesson = t(lessonKey);
      if (lesson === lessonKey || !lesson) break; // Si no existe la traducción, salir del bucle
      lessons.push(lesson);
      lessonIndex++;
    } catch {
      break;
    }
  }
  
  return lessons;
}

// Preparar los datos para cada módulo con los títulos descriptivos y la numeración visible para el usuario
const modules = [
  {
    title: t('courseContent.module0.title'), // Bienvenida al Curso
    description: t('courseContent.module0.description'),
    lessons: getModuleLessons('module0'),
    displayIndex: 0, // Mostrado como Módulo 0
    actualIndex: 0   // Índice real para la numeración de lecciones
  },
  {
    title: t('courseContent.module1.title'), // Ciencia y sus Desafíos
    description: t('courseContent.module1.description'),
    lessons: getModuleLessons('module1'),
    displayIndex: 1,
    actualIndex: 1
  },
  {
    title: t('courseContent.module2.title'), // Introducción a Blockchain y DeSci
    description: t('courseContent.module2.description'),
    lessons: getModuleLessons('module2'),
    displayIndex: 2,
    actualIndex: 2
  },
  {
    title: t('courseContent.module3.title'), // Generaciones Blockchain y Ecosistema Cardano
    description: t('courseContent.module3.description'),
    lessons: getModuleLessons('module3'),
    displayIndex: 3,
    actualIndex: 3
  },
  {
    title: t('courseContent.module4.title'), // Creación de Tokens
    description: t('courseContent.module4.description'),
    lessons: getModuleLessons('module4'),
    displayIndex: 4,
    actualIndex: 4
  },
  {
    title: t('courseContent.module5.title'), // Explorando Contratos Inteligentes con Marlowe
    description: t('courseContent.module5.description'),
    lessons: getModuleLessons('module5'),
    displayIndex: 5,
    actualIndex: 5
  },
  {
    title: t('courseContent.module6.title'), // Temas Avanzados en Cardano
    description: t('courseContent.module6.description'),
    lessons: getModuleLessons('module6'),
    displayIndex: 6,
    actualIndex: 6
  },
  {
    title: t('courseContent.module7.title'), // Cierre del Curso y Evaluación Final
    description: t('courseContent.module7.description'),
    lessons: getModuleLessons('module7'),
    displayIndex: 7,
    actualIndex: 7
  }
];
---

<section id="course-content" class="py-16 bg-gray-50">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <span class="section-tag">{t('courseContent.tag')}</span>
      <h2 class="section-title">{t('courseContent.title')}</h2>
      <p class="section-subtitle">{t('courseContent.subtitle')}</p>
    </div>
    
    <div class="max-w-3xl mx-auto">
      {modules.map((module, i) => (
        <ModuleCard 
          title={module.title}
          description={module.description}
          lessons={module.lessons}
          displayIndex={module.displayIndex}
          actualIndex={module.actualIndex}
          isExpanded={i === 0}
        />
      ))}
    </div>
  </div>
</section>
